<!DOCTYPE HTML><html><head><meta charset="utf-8"><meta name="viewport" content="with=device-width, initial-scale=1.0"><title>Lucas DiCioccio&#39;s blog - Scripting subset of page contents in Dhall.</title><meta name="author" content="Lucas DiCioccio"><meta name="keywords" content="web, haskell, dhall, configuration languages, programming"><meta name="description" content="A demo of using Dhall as an intermediary step for my blog-engine sections."><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Lucas DiCioccio&#39;s blog - Scripting subset of page contents in Dhall."><meta name="twitter:site" content="@lucasdicioccio"><meta name="twitter:creator" content="lucasdicioccio"><meta property="twitter:description" content="A demo of using Dhall as an intermediary step for my blog-engine sections."><meta name="type" property="og:type" content="article"><meta name="title" property="og:title" content="Lucas DiCioccio&#39;s blog - Scripting subset of page contents in Dhall."><meta name="url" property="og:url" content="https://lucasdicioccio.github.io/dhall-section-demo.html"><meta property="og:description" content="A demo of using Dhall as an intermediary step for my blog-engine sections."><meta name="article:published_time" content="2084-04-04"><meta name="ks:article_json" content="/json/dhall-section-demo.cmark.json"><meta name="article:tag" content="web"><meta name="article:tag" content="haskell"><meta name="article:tag" content="dhall"><meta name="article:tag" content="configuration languages"><meta name="article:tag" content="programming"><style>@import "/css/main.css";</style></head><body><div class="main"><article><header class="heading"><h1>Scripting subset of page contents in Dhall.</h1><p>On <span>Tue, 04 Apr 2084</span>, by <a href="https://twitter.com/lucasdicioccio">@lucasdicioccio</a>, 373 words, 5 links, 0images.</p><div class="taglist"><div class="tag"><a class="tag-link" href="/topics/web.html"><span class="tag-name">web</span><span class="tag-count">3</span></a></div><div class="tag"><a class="tag-link" href="/topics/haskell.html"><span class="tag-name">haskell</span><span class="tag-count">5</span></a></div></div></header><div class="upcoming-notice"><p>This article is still considered unfinished and content may change significantly.</p></div><div id="histogram"></div><div class="main-article"><section class="main-section"><p>Since I’ve started building my own blog engine, I wanted some limited scripting
capabilities in the text-processing engine. A specific case I had in mind was
to generate some tables or listing for what you currently find on the
<a href="/readings.html">/readings.html</a> or on the <a href="/tips.html">/tips.html</a> page.</p>
<p>What is common in these pages is the need for:</p>
<ul>
<li>some common structure (e.g., title, urls, language)
</li>
<li>a relatively large amount of items
</li>
<li>some mechanical template application for each item
</li>
</ul>
<p>How these pages are written today is not separating the structure, the content,
and the template.</p>
<p>What I want to avoid is:</p>
<ul>
<li>needing a separate database, even sqlite would be too much overhead to populate
</li>
<li>writing a specific Haskell-side template just for each type of listing
</li>
</ul>
<p>Thus I was eyeing on some way to embed logic that would return some HTML provided some
separation of the three concerns.</p>
<pre><code>&quot;dhall&quot; -&gt; &quot;cmark&quot; -&gt; &quot;html&quot;
</code></pre>
<p>Using <a href="https://dhall-lang.org/">Dhall</a> is a pretty good one-late-evening MVP.</p>
<p>Advantages:</p>
<ul>
<li>demonstrates how simple evaluations could run to replace sections entirely
</li>
<li>first stone in some more advanced form of templating
</li>
<li>interoperability is a bliss in Haskell
</li>
<li>fun
</li>
</ul>
<p>Limitation:</p>
<ul>
<li>so far, no extra/magical environment is passed
</li>
<li>no dependency between sections are planned (need to do detection cycles or find other approaches <span class="emoji" data-emoji="arrow_right">➡️</span> for later)
</li>
</ul>
<p>Drawbacks:</p>
<ul>
<li>evaluation costs time, CPU, file-descriptors
</li>
<li>opacity of intermediary results
</li>
<li>risk of adding non-deterministic content generation (e.g., breaking because I’ve no network, some hackers inserting duck picks or spam because the evaluator fetches from the Internet)
</li>
</ul>
<p>None of these drawbacks are fatal flaws and can be mitigated</p>
<ul>
<li>evaluation costs can be mitigated using some cacheing
</li>
<li>opacity of intermediary results would require exposing the internal ‘Article’ and ‘Section’ objects
</li>
<li>non-determinism is heavily mitigated if we stick to Dhall
</li>
</ul>
<p>Implementation so far is limited but took me a much less than two hours
including babbling-around time.</p>
<p>I had to do the following changes:</p>
<ul>
<li>add a new format (defining a new pattern, and parser pattern)
</li>
<li>import dhall runtime
</li>
<li>insert some case-switch on the section format in the code that loads an Article
</li>
</ul>
<p>You can see for yoursefl in <a href="http://localhost:7654/gen/out/dhall-section-demo.cmark__full-diff">the commit diff</a> .</p>
<p>And you can see this <a href="http://localhost:7654/gen/out/dhall-section-demo.cmark__source-cmark">whole article source</a> including the <code>dhall</code> section.</p>
<p>In the future, the Dhall object to return will be a beefier record rather than just a blob <code>List Text</code>.
For instance, we could return extra information as metadata or as extra instructions that do not find their way in the HTML.</p>
</section><section class="main-section"><h1 id="demo">demo</h1>
<p>this whole <code>&lt;section&gt;</code> is interpreted from Dhall to Cmark to HTML then</p>
<ul>
<li>row-0
</li>
<li>row-1
</li>
<li>row-2
</li>
<li>row-3
</li>
<li>row-4
</li>
<li>row-5
</li>
<li>row-6
</li>
<li>row-7
</li>
<li>row-8
</li>
<li>row-9
</li>
</ul>
</section></div><footer class="footing"><div class="social-links"><a href="https://twitter.com/lucasdicioccio">twitter: @lucasdicioccio</a><a href="https://github.com/lucasdicioccio">github: lucasdicioccio</a><a href="https://linkedin.com/in/lucasdicioccio">linkedin: lucasdicioccio</a></div></footer></article></div><nav id="navigation" class="nav"><a href="/">home</a><div id="search-box"><script type="text/javascript" src="/js/search-box.js" async></script></div></nav></body></html>